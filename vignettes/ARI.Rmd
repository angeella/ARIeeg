---
title: "ARI EEG analysis"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{eeg_lst}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(ARIeeg)
library(eeguana)
library(dplyr)
library(tidyr)
library(purrr)
library(abind)
library(igraph)
library(permuco4brain)
library(ARIpermutation)
load(system.file("extdata", "data_eeg_emotion.RData", package = "ARIeeg"))
```

We apply ARI using EEG data

```{r}
data = utilsTOlst(data=dati)
```

Drop off final 5 channels: 

```{r}
chan_to_rm <- c("RM"  ,  "EOGvo" ,"EOGvu"
                , "EOGhl", "EOGhr")
data <- 
  data %>%
  select(-one_of(chan_to_rm))
```

Segments data and select two conditions:

```{r}
data_seg <- data %>%
  eeg_segment(.description %in% c(4,5),
              lim = c(min(dati$timings$time), max(dati$timings$time))
  ) %>% eeg_baseline()  %>%
  mutate(
    condition =
      description
  ) %>%
  select(-c(type,description))
```

# Simes family

$\delta = 0$

```{r}
ARIpermEEG(data=data_seg, alpha=0.1, family="Simes", delta=0, ct=c(0,1), alternative = "two.sided", timeS = c(100:500), dist = 53, formula = signal ~ condition + Error(.subj/(condition)), variable = c(".subj", "condition"), B = 5000, effect = "condition")
```

$\delta = 50$

```{r}
ARIpermEEG(data=data_seg, alpha=0.1, family="Simes", delta=50, ct=c(0,1), alternative = "two.sided", timeS = c(100:500), dist = 53, formula = signal ~ condition + Error(.subj/(condition)), variable = c(".subj", "condition"), B = 5000, effect = "condition")
```

$\delta = 100$

```{r}
ARIpermEEG(data=data_seg, alpha=0.1, family="Simes", delta=100, ct=c(0,1), alternative = "two.sided", timeS = c(100:500), dist = 53, formula = signal ~ condition + Error(.subj/(condition)), variable = c(".subj", "condition"), B = 5000, effect = "condition")
```

# Finner family

$\delta = 0$

```{r}
ARIpermEEG(data=data_seg, alpha=0.1, family="Finner", delta=0, ct=c(0,1), alternative = "two.sided", timeS = c(100:500), dist = 53, formula = signal ~ condition + Error(.subj/(condition)), variable = c(".subj", "condition"), B = 5000, effect = "condition")
```

$\delta = 50$

```{r}
ARIpermEEG(data=data_seg, alpha=0.1, family="Finner", delta=50, ct=c(0,1), alternative = "two.sided", timeS = c(100:500), dist = 53, formula = signal ~ condition + Error(.subj/(condition)), variable = c(".subj", "condition"), B = 5000, effect = "condition")
```

$\delta = 100$

```{r}
ARIpermEEG(data=data_seg, alpha=0.1, family="Finner", delta=100, ct=c(0,1), alternative = "two.sided", timeS = c(100:500), dist = 53, formula = signal ~ condition + Error(.subj/(condition)), variable = c(".subj", "condition"), B = 5000, effect = "condition")
```

# Beta 

```{r}
ARIpermEEG(data=data_seg, alpha=0.1, family="beta", delta=0, ct=c(0,1), alternative = "two.sided", timeS = c(100:500), dist = 53, formula = signal ~ condition + Error(.subj/(condition)), variable = c(".subj", "condition"), B = 5000, effect = "condition")
```

# higher criticism 

```{r}
ARIpermEEG(data=data_seg, alpha=0.1, family="higher.criticism", delta=0, ct=c(0,1), alternative = "two.sided", timeS = c(100:500), dist = 53, formula = signal ~ condition + Error(.subj/(condition)), variable = c(".subj", "condition"), B = 5000, effect = "condition")
```